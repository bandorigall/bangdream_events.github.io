
<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BanG Dream! í•œêµ­ ì˜¤í”„ë¼ì¸ ì´ë²¤íŠ¸ ëª©ë¡</title>
    
    <script src='https://cdn.jsdelivr.net/npm/fullcalendar@6.1.10/index.global.min.js'></script>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

    <style>
        :root { 
            --bg: #f4f6f8; 
            --accent: #ff4081; 
            --dark: #333; 
            --gray: #b0b0b0;
        }
        body { 
            margin: 0; padding: 0; 
            font-family: 'Pretendard', -apple-system, sans-serif; 
            background: var(--bg); 
            height: 100vh; 
            display: flex; 
            overflow: hidden; 
            color: var(--dark); 
        }
        
        .left-panel { 
            width: 50%; 
            padding: 25px; 
            background: #fff; 
            border-right: 1px solid #e0e0e0; 
            box-sizing: border-box;
            display: flex;
            flex-direction: column;
            z-index: 10;
        }
        
        h1.page-title { 
            font-size: 1.8rem; 
            margin: 0 0 25px 0; 
            color: var(--accent); 
            font-weight: 800; 
            text-align: center; 
            flex-shrink: 0; 
        }
        
        .card-list-container {
            flex: 1; 
            overflow-y: auto; 
            padding-right: 5px; 
        }

        #card-list {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
        }

        .footer-credits {
            text-align: center;
            font-size: 0.8rem;
            color: #999;
            padding-top: 20px;
            margin-top: auto;
            font-weight: 500;
            line-height: 1.4;
            font-family: 'Courier New', monospace;
        }

        .event-card {
            background: #ffffff; 
            border: 1px solid #eee; 
            border-radius: 12px;
            padding: 15px; 
            cursor: pointer;
            transition: all 0.2s ease; 
            position: relative;
            display: flex; 
            flex-direction: column; 
            justify-content: space-between;
        }
        .event-card:hover { 
            transform: translateY(-3px); 
            box-shadow: 0 5px 15px rgba(0,0,0,0.08); 
            border-color: var(--accent); 
        }
        .event-card.active { 
            border: 2px solid var(--accent); 
            background: #fff0f5; 
        }
        
        .card-title { font-size: 1.1rem; font-weight: 700; margin-bottom: 8px; word-break: keep-all; }
        .card-date { font-size: 0.85rem; color: #666; margin-bottom: 5px; }
        .card-loc { font-size: 0.85rem; color: #555; font-weight: 500; }

        .right-panel { 
            width: 50%; 
            display: flex; 
            flex-direction: column; 
        }
        
        .top-calendar { 
            height: 45%; 
            padding: 20px; 
            background: #fff; 
            border-bottom: 1px solid #ddd; 
            overflow: hidden;
        }
        
        .bottom-container { 
            height: 55%; 
            display: flex; 
            background: #fff; 
        }

        .info-area {
            width: 340px; 
            min-width: 300px; 
            padding: 25px;
            border-right: 1px solid #eee; 
            overflow-y: auto;
            display: flex; 
            flex-direction: column; 
            background: #fcfcfc;
        }
        
        .map-area { 
            flex: 1; 
            position: relative; 
        }
        #map { width: 100%; height: 100%; z-index: 1; }

        .panel-header { font-size: 1.4rem; font-weight: 800; margin-bottom: 15px; color: var(--accent); line-height: 1.2; }
        .empty-msg { color: #999; text-align: center; margin-top: 50px; }
        
        .btn-group { display: flex; flex-direction: column; gap: 8px; margin-bottom: 20px; }
        .btn { 
            padding: 10px 14px; border-radius: 8px; text-decoration: none; 
            font-size: 0.9rem; font-weight: 600; color: white; border: none; cursor: pointer;
            display: flex; align-items: center; justify-content: space-between; transition: 0.2s;
        }
        .btn:hover { opacity: 0.9; transform: translateX(3px); }
        .btn-naver { background-color: #03C75A; }
        .btn-kakao { background-color: #FEE500; color: #191919; }
        
        .note-text { font-size: 0.9rem; background: #fff3cd; color: #856404; padding: 12px; border-radius: 8px; margin-bottom: 15px; }
        
        .btn-super-main {
            display: block; width: 100%; box-sizing: border-box; text-align: center; 
            background: linear-gradient(135deg, #ff4081, #ff80ab); color: white;
            font-size: 1.1rem; font-weight: bold; padding: 15px; 
            border-radius: 12px; margin-top: auto; 
            text-decoration: none; box-shadow: 0 4px 10px rgba(233, 30, 99, 0.2);
            transition: 0.2s;
        }
        .btn-super-main:hover { transform: translateY(-2px); box-shadow: 0 6px 15px rgba(233, 30, 99, 0.3); }

        @media (max-width: 900px) {
            body { flex-direction: column; overflow: auto; }
            .left-panel, .right-panel { width: 100%; height: auto; }
            .left-panel { height: 500px; border-bottom: 5px solid #eee; }
            #card-list { grid-template-columns: 1fr; } 
            .bottom-container { flex-direction: column; height: auto; }
            .info-area { width: 100%; height: auto; border-right: none; border-bottom: 1px solid #ddd; }
            .map-area { height: 400px; }
        }
    </style>
</head>
<body>

<div class="left-panel">
    <h1 class="page-title">BanG Dream!<br>í•œêµ­ ì˜¤í”„ë¼ì¸ ì´ë²¤íŠ¸ ëª©ë¡</h1>
    <div class="card-list-container">
        <div id="card-list"></div>
    </div>
    <div class="footer-credits">
        ë°ì´í„° ì—…ë°ì´íŠ¸: 2026.01.25 12:53:06<br>
        (ì ‘ì†ì¼ ê¸°ì¤€ ì§€ë‚œ í–‰ì‚¬ëŠ” ìˆ¨ê¹€ ì²˜ë¦¬ë¨)<br>
        made by Bangbung Kim
    </div>
</div>

<div class="right-panel">
    <div class="top-calendar">
        <div id='calendar'></div>
    </div>
    <div class="bottom-container">
        <div class="info-area" id="info-panel">
            <div class="empty-msg">
                ì´ë²¤íŠ¸ë¥¼ ì„ íƒí•˜ë©´<br>ì—¬ê¸°ì— ìƒì„¸ ì •ë³´ê°€ ë‚˜ì˜µë‹ˆë‹¤!
            </div>
        </div>
        <div class="map-area">
            <div id="map"></div>
        </div>
    </div>
</div>

<script>
    // 1. Pythonì—ì„œ ëª¨ë“  ë°ì´í„°(ê³¼ê±°+ë¯¸ë˜)ë¥¼ rawEventsì— ë‹´ìŠµë‹ˆë‹¤.
    const rawEvents = [{"id": 0, "title": "ë¡œì ¤ë¦¬ì•„ ë‚´í•œê³µì—° ê¸°ë… ì§€í•˜ì²  ê´‘ê³ ", "start": "2025-11-25", "end": "2025-12-31", "cal_end": "2026-01-01", "location_text": "ì•ˆì•”ì—­, í™ëŒ€ì…êµ¬ì—­", "map_targets": [{"name": "ì•ˆì•”ì—­", "n_link": "https://naver.me/x95K7RnH", "k_link": "https://place.map.kakao.com/SES2640", "lat": 37.58645750817225, "lng": 127.02915845433826}, {"name": "í™ëŒ€ì…êµ¬ì—­", "n_link": "https://naver.me/FpZVriqO", "k_link": "https://place.map.kakao.com/SES3149", "lat": 37.55787506501278, "lng": 126.92529418317213}], "main_link": "https://gall.dcinside.com/mgallery/board/view/?id=bang_dream&no=5766158", "note": ""}, {"id": 1, "title": "BanG Dream! 10ì£¼ë…„ì˜ ê¶¤ì å±•", "start": "2025-12-04", "end": "2026-02-01", "cal_end": "2026-02-02", "location_text": "AKí”Œë¼ì 3ì¸µ Space Galleria", "map_targets": [{"name": "AKí”Œë¼ì 3ì¸µ Space Galleria", "n_link": "https://naver.me/56R6OZp0", "k_link": "https://place.map.kakao.com/1156421273", "lat": 37.55800358022958, "lng": 126.92646032734649}], "main_link": "https://gall.dcinside.com/mgallery/board/view/?id=bang_dream&no=5757227", "note": ""}, {"id": 2, "title": "10ì£¼ë…„ ì „ì‹œíšŒ ê·¸ë¼ë–¼", "start": "2025-12-04", "end": "2026-01-18", "cal_end": "2026-01-19", "location_text": "animate cafe í™ëŒ€ì , ì ì‹¤ë¡¯ë°ì ", "map_targets": [{"name": "animate cafe í™ëŒ€ì ", "n_link": "https://naver.me/GG7tdmN3", "k_link": "https://place.map.kakao.com/1569179864", "lat": 37.558246784781225, "lng": 126.92608361200716}, {"name": "ì ì‹¤ë¡¯ë°ì ", "n_link": "https://naver.me/xS1FI9HO", "k_link": "https://place.map.kakao.com/1680392963", "lat": 37.516317710608405, "lng": 127.10478947576965}], "main_link": "https://gall.dcinside.com/mgallery/board/view/?id=bang_dream&no=5760244", "note": ""}, {"id": 3, "title": "10ì£¼ë…„ ì „ì‹œíšŒ X ê·¸ë¼ë–¼ ì´ë²¤íŠ¸", "start": "2025-12-04", "end": "2025-12-31", "cal_end": "2026-01-01", "location_text": "AKí”Œë¼ì 3ì¸µ Space Galleria", "map_targets": [{"name": "AKí”Œë¼ì 3ì¸µ Space Galleria", "n_link": "https://naver.me/56R6OZp0", "k_link": "https://place.map.kakao.com/1156421273", "lat": 37.55800358022958, "lng": 126.92646032734649}], "main_link": "https://gall.dcinside.com/mgallery/board/view/?id=bang_dream&no=5773553", "note": "ì—†ì–´ì§€ëŠ” ëŒ€ë¡œ ì¢…ë£Œ"}, {"id": 4, "title": "10ì£¼ë…„ ì „ì‹œíšŒ ê´‘ê³  ì¸ì¦ìƒ· ì´ë²¤íŠ¸", "start": "2025-12-08", "end": "2025-12-21", "cal_end": "2025-12-22", "location_text": "AKí”Œë¼ì 3ì¸µ Space Galleria", "map_targets": [{"name": "AKí”Œë¼ì 3ì¸µ Space Galleria", "n_link": "https://naver.me/56R6OZp0", "k_link": "https://place.map.kakao.com/1156421273", "lat": 37.55800358022958, "lng": 126.92646032734649}], "main_link": "https://gall.dcinside.com/mgallery/board/view/?id=bang_dream&no=5784857", "note": ""}, {"id": 5, "title": "BanG Dream! Roselia ASIA TOUR in animate", "start": "2025-12-10", "end": "2025-01-25", "cal_end": "2025-01-26", "location_text": "animate í™ëŒ€ì , ì ì‹¤ë¡¯ë°ì , ë¶€ì‚°ì , ì˜¨ë¼ì¸ìƒµ", "map_targets": [{"name": "animate í™ëŒ€ì ", "n_link": "https://naver.me/GG7tdmN3", "k_link": "https://place.map.kakao.com/1569179864", "lat": 37.55818454896633, "lng": 126.92617941385133}, {"name": "ì ì‹¤ë¡¯ë°ì ", "n_link": "https://naver.me/xS1FI9HO", "k_link": "https://place.map.kakao.com/1680392963", "lat": 37.51388178795134, "lng": 127.10376405064737}, {"name": "ë¶€ì‚°ì ", "n_link": "https://naver.me/G65tVa3l", "k_link": "https://place.map.kakao.com/1952409629", "lat": 35.153133170168324, "lng": 129.05952158124504}], "main_link": "https://gall.dcinside.com/mgallery/board/view/?id=bang_dream&no=5785195", "note": ""}, {"id": 6, "title": "ì„œìš¸ì½”ë¯¹ì›”ë“œ", "start": "2025-12-20", "end": "2025-12-21", "cal_end": "2025-12-22", "location_text": "ê³ ì–‘ í‚¨í…ìŠ¤ 1ì „ì‹œê´€", "map_targets": [{"name": "ê³ ì–‘ í‚¨í…ìŠ¤ 1ì „ì‹œê´€", "n_link": "https://naver.me/xKERd3MA", "k_link": "https://place.map.kakao.com/11373858", "lat": 37.66975449439994, "lng": 126.7449148680072}], "main_link": "https://gall.dcinside.com/mgallery/board/view/?id=bang_dream&no=5788852", "note": ""}, {"id": 7, "title": "ê·¸ë¼ë–¼ ë¡œì ¤ ë‚´í•œê¸°ë…", "start": "2025-12-20", "end": "2026-01-25", "cal_end": "2026-01-26", "location_text": "animate cafe í™ëŒ€ì , ì ì‹¤ë¡¯ë°ì ", "map_targets": [{"name": "animate cafe í™ëŒ€ì ", "n_link": "https://naver.me/GG7tdmN3", "k_link": "https://place.map.kakao.com/1569179864", "lat": 37.55818454896633, "lng": 126.92617941385133}, {"name": "ì ì‹¤ë¡¯ë°ì ", "n_link": "https://naver.me/xS1FI9HO", "k_link": "https://place.map.kakao.com/1680392963", "lat": 37.51388178795134, "lng": 127.10376405064737}], "main_link": "https://gall.dcinside.com/mgallery/board/view/?id=bang_dream&no=5746277", "note": "ì¿ í‚¤ëŠ” í™ëŒ€ì  í•œì •ì´ë‹ˆ ìœ ì˜"}, {"id": 8, "title": "10ì£¼ë…„ ì „ì‹œíšŒ í¬ë¦¬ìŠ¤ë§ˆìŠ¤ ì´ë²¤íŠ¸", "start": "2025-12-20", "end": "2025-12-26", "cal_end": "2025-12-27", "location_text": "AKí”Œë¼ì 3ì¸µ Space Galleria", "map_targets": [{"name": "AKí”Œë¼ì 3ì¸µ Space Galleria", "n_link": "https://naver.me/56R6OZp0", "k_link": "https://place.map.kakao.com/1156421273", "lat": 37.55800358022958, "lng": 126.92646032734649}], "main_link": "https://gall.dcinside.com/mgallery/board/view/?id=bang_dream&no=5801795", "note": ""}, {"id": 9, "title": "ë¡œì ¤ë¦¬ì•„ ì•„ì‹œì•„íˆ¬ì–´ Neuweltfahrt ì„œìš¸ ê³µì—°", "start": "2025-12-24", "end": "2025-12-24", "cal_end": "2025-12-25", "location_text": "ê³ ë ¤ëŒ€í•™êµ í™”ì •ì²´ìœ¡ê´€", "map_targets": [{"name": "ê³ ë ¤ëŒ€í•™êµ í™”ì •ì²´ìœ¡ê´€", "n_link": "https://naver.me/GdymhkvA", "k_link": "https://place.map.kakao.com/13314631", "lat": 37.59288189776369, "lng": 127.02475154084323}], "main_link": "https://gall.dcinside.com/mgallery/board/view/?id=bang_dream&no=5599446", "note": ""}, {"id": 10, "title": "ã€ŒBanG Dream! Ave Mujicaã€ì½œë¼ë³´ ì¹´í˜", "start": "2026-01-08", "end": "2026-02-08", "cal_end": "2026-02-09", "location_text": "ì• ë‹ˆí”ŒëŸ¬ìŠ¤ í•©ì •, ì„œë©´ì ", "map_targets": [{"name": "ì• ë‹ˆí”ŒëŸ¬ìŠ¤ í•©ì •", "n_link": "https://naver.me/G2EwHi2N", "k_link": "https://place.map.kakao.com/577828045", "lat": 37.55074727367116, "lng": 126.91162102550213}, {"name": "ì„œë©´ì ", "n_link": "https://naver.me/G2EwxwKT", "k_link": "https://place.map.kakao.com/1789799749", "lat": 35.153170546784594, "lng": 129.0595959830892}], "main_link": "https://gall.dcinside.com/mgallery/board/view/?id=bang_dream&no=5805552", "note": ""}, {"id": 11, "title": "ë±…ë“œë¦¼ ì»¤ë²„ë¼ì´ë¸Œ Winter BANG", "start": "2026-01-17", "end": "2026-01-17", "cal_end": "2026-01-18", "location_text": "ëŒ€ì „ ìŒì•…ì°½ì‘ì†Œ", "map_targets": [{"name": "ëŒ€ì „ ìŒì•…ì°½ì‘ì†Œ", "n_link": "https://naver.me/FQVGOaxh", "k_link": "https://place.map.kakao.com/613163072", "lat": 36.326449672341255, "lng": 127.43034269662424}], "main_link": "https://gall.dcinside.com/mgallery/board/view/?id=bang_dream&no=5762185", "note": ""}, {"id": 12, "title": "í•©ì • DreamStagePass", "start": "2026-01-25", "end": "2026-01-25", "cal_end": "2026-01-26", "location_text": "í•©ì • ë“œë¦¼í™€", "map_targets": [{"name": "í•©ì • ë“œë¦¼í™€", "n_link": "https://naver.me/F5D17C3d", "k_link": "https://place.map.kakao.com/26490207", "lat": 37.55051169818805, "lng": 126.91581415433701}], "main_link": "https://gall.dcinside.com/mgallery/board/view/?id=bang_dream&no=5899420", "note": ""}, {"id": 13, "title": "2026 ë ˆì´ì•¼ ìƒì¼ê¸°ë… ê´‘ê³ ", "start": "2026-01-12", "end": "2026-02-10", "cal_end": "2026-02-11", "location_text": "ì ì‹¤ì—­ 8í˜¸ì„  ì„ì´Œ ë°©ë©´(ìŠ¹ê°•ì¥ ì–‘ìª½ ê³„ë‹¨ ì‚¬ì´ ì „ê´‘íŒ)", "map_targets": [{"name": "ì ì‹¤ì—­ 8í˜¸ì„  ì„ì´Œ ë°©ë©´(ìŠ¹ê°•ì¥ ì–‘ìª½ ê³„ë‹¨ ì‚¬ì´ ì „ê´‘íŒ)", "n_link": "https://naver.me/Fm2gWbIO", "k_link": "https://place.map.kakao.com/SES2815", "lat": 37.51440119622173, "lng": 127.10316850297033}], "main_link": "https://gall.dcinside.com/mgallery/board/view/?id=bang_dream&no=5843113", "note": "ì„ì´Œ ë°©ë©´ (ìŠ¹ê°•ì¥ ì–‘ìª½ ê³„ë‹¨ ì‚¬ì´ ì „ê´‘íŒ)"}, {"id": 14, "title": "[ëª¨ê¸ˆ] ë¯¼íŠ¸ìë§¤ ì „ê´‘íŒ í”„ë¡œì íŠ¸", "start": "2026-01-01", "end": "2026-02-10", "cal_end": "2026-02-11", "location_text": "ê³µí•­ì² ë„ í™ëŒ€ì…êµ¬ì—­", "map_targets": [{"name": "ê³µí•­ì² ë„ í™ëŒ€ì…êµ¬ì—­", "n_link": "https://naver.me/FpZVriqO", "k_link": "https://place.map.kakao.com/SES3149", "lat": 37.55788357016835, "lng": 126.92526199666752}], "main_link": "https://gall.dcinside.com/mgallery/board/view/?id=bang_dream&no=5844984", "note": "ì¢…ë£Œ ì‹œê¸°ì™€ ì„¤ì¹˜ ì¥ì†ŒëŠ” ë³€ë™ ê°€ëŠ¥ (í• ê±°ë©´ ìµœëŒ€í•œ ë¹¨ë¦¬ í•˜ì„¸ìš”)"}];
    
    // 2. í˜„ì¬ ì ‘ì†í•œ ì‹œê°„ì„ ê¸°ì¤€ìœ¼ë¡œ í•„í„°ë§ëœ ì´ë²¤íŠ¸ë§Œ ë‹´ì„ ë³€ìˆ˜
    let events = [];
    
    let map = null;
    let calendar = null;
    let markers = [];

    document.addEventListener('DOMContentLoaded', function() {
        // [í•µì‹¬ ë¡œì§] ì ‘ì† ì‹œì (Client Side) ë‚ ì§œ í•„í„°ë§ ì‹¤í–‰
        filterEventsByCurrentDate();

        map = L.map('map').setView([37.5665, 126.9780], 11);
        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
            attribution: 'Â© OpenStreetMap'
        }).addTo(map);

        const calendarEl = document.getElementById('calendar');
        calendar = new FullCalendar.Calendar(calendarEl, {
            initialView: 'dayGridMonth',
            height: '100%',
            headerToolbar: { left: 'prev,next today', center: 'title', right: '' },
            events: getAllCalendarEvents(),
            eventClick: function(info) {
                selectEvent(parseInt(info.event.id));
            }
        });
        calendar.render();
        renderCards();
    });

    // ì ‘ì†í•œ ì‚¬ìš©ìì˜ ë¡œì»¬ ì‹œê°„ì„ ê¸°ì¤€ìœ¼ë¡œ ì§€ë‚œ ì´ë²¤íŠ¸ë¥¼ ì œì™¸í•˜ëŠ” í•¨ìˆ˜
    function filterEventsByCurrentDate() {
        const now = new Date();
        // ì‹œê°„ì„ 00:00:00ìœ¼ë¡œ ì´ˆê¸°í™”í•˜ì—¬ ë‚ ì§œë§Œ ë¹„êµ (ì˜¤ëŠ˜ ì¢…ë£Œë˜ëŠ” ì´ë²¤íŠ¸ë„ ë³´ì´ê²Œ í•¨)
        now.setHours(0, 0, 0, 0);

        events = rawEvents.filter(evt => {
            // evt.endëŠ” 'YYYY-MM-DD' í˜•ì‹ì´ë¯€ë¡œ Date ê°ì²´ë¡œ ë³€í™˜
            const endDate = new Date(evt.end);
            // ì¢…ë£Œì¼ì´ ì˜¤ëŠ˜ê³¼ ê°™ê±°ë‚˜ ë¯¸ë˜ì¸ ê²½ìš°ë§Œ ìœ ì§€
            return endDate >= now;
        });
        
        console.log(`ì´ ${rawEvents.length}ê°œ ì¤‘ ${events.length}ê°œì˜ ìœ íš¨ ì´ë²¤íŠ¸ ë¡œë“œë¨.`);
    }

    function getAllCalendarEvents() {
        // events ë³€ìˆ˜ëŠ” ì´ë¯¸ í•„í„°ë§ëœ ë¦¬ìŠ¤íŠ¸ì…ë‹ˆë‹¤.
        return events.map(e => ({
            id: e.id, 
            title: e.title, 
            start: e.start, 
            end: e.cal_end, 
            color: '#d1d1d1'
        }));
    }

    function renderCards() {
        const container = document.getElementById('card-list');
        container.innerHTML = ''; // ì´ˆê¸°í™”
        
        if (events.length === 0) {
            container.innerHTML = '<div style="text-align:center; padding:20px; color:#999;">ì§„í–‰ ì¤‘ì¸ ì´ë²¤íŠ¸ê°€ ì—†ìŠµë‹ˆë‹¤.</div>';
            return;
        }

        events.forEach(evt => {
            const card = document.createElement('div');
            card.className = 'event-card';
            card.dataset.id = evt.id;
            card.onclick = () => selectEvent(evt.id);
            card.innerHTML = `
                <div class="card-title">${evt.title}</div>
                <div class="card-date">ğŸ—“ï¸ ${evt.start} ~ ${evt.end}</div>
                <div class="card-loc">ğŸ“ ${evt.location_text}</div>
            `;
            container.appendChild(card);
        });
    }

    function selectEvent(id) {
        // í•„í„°ë§ëœ events ëª©ë¡ì—ì„œ ì°¾ìŒ
        const evt = events.find(e => e.id === id);
        if (!evt) return; // í˜¹ì‹œ í•„í„°ë§ëœ ì´ë²¤íŠ¸ë¥¼ í´ë¦­í–ˆë‹¤ë©´ ë¬´ì‹œ

        document.querySelectorAll('.event-card').forEach(c => c.classList.remove('active'));
        document.querySelector(`.event-card[data-id="${id}"]`)?.classList.add('active');

        const allCalEvents = calendar.getEvents();
        allCalEvents.forEach(calEvt => {
            if (parseInt(calEvt.id) === id) {
                calEvt.setProp('color', '#ff4081');
            } else {
                calEvt.setProp('color', '#d1d1d1');
            }
        });
        calendar.gotoDate(evt.start);

        markers.forEach(m => map.removeLayer(m));
        markers = [];
        let bounds = L.latLngBounds();
        let hasCoords = false;

        evt.map_targets.forEach(target => {
            if (target.lat && target.lng) {
                const marker = L.marker([target.lat, target.lng]).addTo(map);
                marker.bindPopup(`<b>${target.name}</b>`);
                markers.push(marker);
                bounds.extend([target.lat, target.lng]);
                hasCoords = true;
            }
        });

        setTimeout(() => {
            map.invalidateSize();
            if (hasCoords) {
                map.fitBounds(bounds, { padding: [50, 50], maxZoom: 14 });
            }
        }, 100);

        const panel = document.getElementById('info-panel');
        let btnsHtml = '<div class="btn-group">';
        
        evt.map_targets.forEach(target => {
            const zoomAttr = (target.lat && target.lng) 
                ? `onclick="zoomToLocation(${target.lat}, ${target.lng})"` 
                : '';
            
            if (target.n_link) {
                btnsHtml += `<a href="${target.n_link}" target="_blank" class="btn btn-naver" ${zoomAttr}><span>N ë„¤ì´ë²„ì§€ë„ (${target.name})</span> <span>âš</span></a>`;
            }
            
            if (target.k_link) {
                btnsHtml += `<a href="${target.k_link}" target="_blank" class="btn btn-kakao" ${zoomAttr}><span>K ì¹´ì¹´ì˜¤ë§µ (${target.name})</span> <span>âš</span></a>`;
            }
        });
        btnsHtml += '</div>';

        let noteHtml = evt.note ? `<div class="note-text">ğŸ“¢ ${evt.note}</div>` : '';
        let mainLinkHtml = evt.main_link ? `<a href="${evt.main_link}" target="_blank" class="btn btn-super-main">ğŸ‘‰ í†µí•© ì •ë³´ í™•ì¸í•˜ê¸°</a>` : '';

        panel.innerHTML = `
            <div class="panel-header">${evt.title}</div>
            ${noteHtml}
            ${btnsHtml}
            ${mainLinkHtml}
        `;
    }

    function zoomToLocation(lat, lng) {
        map.flyTo([lat, lng], 17, { animate: true, duration: 1.5 });
    }
</script>
</body>
</html>
